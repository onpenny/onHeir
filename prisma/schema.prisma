generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String?
  password      String
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  families      FamilyMember[]
  assets        Asset[]
  wills         Will[]
  donations     Donation[]
  notifications Notification[]

  @@map("users")
}

model Family {
  id          String    @id @default(cuid())
  name        String
  description String?
  createdBy   String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  members     FamilyMember[]

  @@map("families")
}

model FamilyMember {
  id          String    @id @default(cuid())
  userId      String
  familyId    String
  relationship String    // 父母、配偶、子女等
  priority    Int       @default(0) // 继承优先级

  user        User      @relation(fields: [userId], references: [id])
  family      Family    @relation(fields: [familyId], references: [id])

  @@unique([userId, familyId])
  @@map("family_members")
}

model Asset {
  id          String    @id @default(cuid())
  userId      String
  type        String    // 银行、保险、证券、不动产、虚拟资产等
  name        String
  description String?
  value       Float?
  currency    String    @default("CNY")
  location    String?   // 资产所在地
  provider    String?   // 机构名称
  accountNum  String?   // 账号/编号
  isPublic    Boolean   @default(false) // 是否对继承人公开
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  user        User      @relation(fields: [userId], references: [id])
  allocations AssetAllocation[]

  @@map("assets")
}

model AssetAllocation {
  id          String    @id @default(cuid())
  assetId     String
  familyId    String?
  memberId    String?
  percentage  Float     // 分配比例

  asset       Asset     @relation(fields: [assetId], references: [id])

  @@map("asset_allocations")
}

model Will {
  id          String    @id @default(cuid())
  userId      String
  title       String
  content     String
  status      String    @default("draft") // draft, active, executed
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  user        User      @relation(fields: [userId], references: [id])

  @@map("wills")
}

model Donation {
  id          String    @id @default(cuid())
  userId      String
  type        String    // 财产、文物、遗体、器官
  amount      Float?
  description String?
  organization String?  // 捐赠机构
  status      String    @default("pending") // pending, approved, executed

  user        User      @relation(fields: [userId], references: [id])

  @@map("donations")
}

model Notification {
  id          String    @id @default(cuid())
  userId      String
  type        String
  title       String
  message     String
  isRead      Boolean   @default(false)
  createdAt   DateTime  @default(now())

  user        User      @relation(fields: [userId], references: [id])

  @@map("notifications")
}
